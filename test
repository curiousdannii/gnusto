#!/usr/bin/env xpcshell

dump('Loading story... ');
f = new Components.Constructor('@mozilla.org/file/local;1',
			       'nsILocalFile',
			       'initWithPath')('troll.mz5');

var fc = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
  	 
fc.init(f, 1, 0, 0); 	 

var sis = new Components.Constructor("@mozilla.org/scriptableinputstream;1", 	 
				     "nsIScriptableInputStream")(); 	 
sis.init(fc);
var content = sis.read(f.fileSize); 	 
fc.close(); 	 
dump('done.\n');

if (content.length!=f.fileSize) { 	 
  dump('\nYou seem to have opened an ordinary, non-encoded story file.\n\n');
  quit(1);
}

dump('In test. Game is '+content.length+' bytes.\n');
var engine = Components.Constructor('@gnusto.org/engine;1',
				    'gnustoIEngine',
				    'loadStoryMZ5')(content);

dump(engine.cvsVersion);
dump('\n');

dump(engine.status);
dump('\n');



